# ü§ñ Mirza Telegram Shop Bot

[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)](https://python.org)
[![aiogram](https://img.shields.io/badge/aiogram-3.21+-green.svg)](https://aiogram.dev)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-15+-blue.svg)](https://postgresql.org)
[![Redis](https://img.shields.io/badge/Redis-7+-red.svg)](https://redis.io)
[![Docker](https://img.shields.io/badge/Docker-Compose-blue.svg)](https://docker.com)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Telegram –±–æ—Ç –¥–ª—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –∫–æ–º–º–µ—Ä—Ü–∏–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –ø–ª–∞—Ç–µ–∂–µ–π Heleket, –±–∞–ª–∞–Ω—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ–∫—É–ø–∫–æ–π –∑–≤–µ–∑–¥ —á–µ—Ä–µ–∑ Fragment API –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö SOLID, DRY, KISS —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#Ô∏è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
- [üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#Ô∏è-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
- [‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#Ô∏è-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- [üê≥ Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#-docker-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
- [üì° API –∏ –í–µ–±—Ö—É–∫–∏](#-api-–∏-–≤–µ–±—Ö—É–∫–∏)
- [üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
- [üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç](#-–≤–∫–ª–∞–¥-–≤-–ø—Ä–æ–µ–∫—Ç)

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [üèóÔ∏è –î–µ—Ç–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](docs/ARCHITECTURE.md) - –ü–æ–¥—Ä–æ–±–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- [üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ DevOps](docs/DEPLOYMENT.md) - CI/CD, Docker, –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [üîí SSL –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](docs/SSL_SETUP.md) - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL/TLS —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```mermaid
graph TB
    subgraph "External Services"
        TG[Telegram API]
        HELEKET[Heleket Payment API]
        FRAGMENT[Telegram Fragment API]
        CLOUDFLARE[Cloudflare Tunnel]
    end

    subgraph "Load Balancer & Proxy"
        NGINX[Nginx Reverse Proxy]
        CF_WAF[Cloudflare WAF]
    end

    subgraph "Application Layer"
        BOT[Telegram Bot Core]
        WEBHOOK[Webhook Service]
        API[REST API Service]
    end

    subgraph "Business Logic Layer"
        MH[Message Handler]
        PS[Payment Service]
        BS[Balance Service]
        SPS[Star Purchase Service]
        FS[Fragment Service]
        RL[Advanced Rate Limiter]
        CB[Circuit Breaker]
    end

    subgraph "Data Access Layer"
        UR[User Repository]
        BR[Balance Repository]
        TR[Transaction Repository]
    end

    subgraph "Infrastructure Layer"
        PG[(PostgreSQL Cluster)]
        REDIS[(Redis HA Cluster)]
        PROMETHEUS[(Prometheus)]
        GRAFANA[(Grafana)]
    end

    TG --> CF_WAF
    HELEKET --> CF_WAF
    FRAGMENT --> CF_WAF
    CLOUDFLARE --> CF_WAF
    CF_WAF --> NGINX

    NGINX --> BOT
    NGINX --> WEBHOOK
    NGINX --> API

    BOT --> MH
    WEBHOOK --> PS
    API --> MH

    MH --> PS
    MH --> BS
    MH --> SPS
    MH --> FS
    MH --> RL
    MH --> CB

    PS --> UR
    BS --> BR
    SPS --> UR
    SPS --> BR
    FS --> UR

    UR --> PG
    BR --> PG
    TR --> PG

    RL --> REDIS
    CB --> REDIS
    MH --> REDIS

    PROMETHEUS --> BOT
    PROMETHEUS --> WEBHOOK
    PROMETHEUS --> API
    PROMETHEUS --> PG
    PROMETHEUS --> REDIS

    GRAFANA --> PROMETHEUS
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
flowchart LR
    subgraph handlers ["üéØ Handlers Layer"]
        MH["üì® Message Handler"]
        BH["üîß Base Handler"]
        EH["‚ùå Error Handler"]
        PH["üí≥ Payment Handler"]
        PuH["üõí Purchase Handler"]
        BalH["üí∞ Balance Handler"]
    end

    subgraph services ["‚öôÔ∏è Services Layer"]
        PS["üí≥ Payment Service"]
        BS["üí∞ Balance Service"]
        SPS["‚≠ê Star Purchase Service"]
        FS["üíé Fragment Service"]
        FCM["üç™ Fragment Cookie Manager"]
        CS["üóÑÔ∏è Cache Service"]
        RL["üö¶ Advanced Rate Limiter"]
        CB["üîÑ Circuit Breaker"]
        HS["‚ù§Ô∏è Health Service"]
        WS["üîå Webhook Service"]
    end

    subgraph repos ["üìä Repository Layer"]
        UR["üë§ User Repository"]
        BR["üí∞ Balance Repository"]
        TR["üìä Transaction Repository"]
    end

    subgraph core ["üèóÔ∏è Core Layer"]
        INT["üîó Interfaces ABC"]
        CFG["‚öôÔ∏è Configuration"]
        DT["üìã Data Transfer Objects"]
    end

    MH --> PS
    MH --> BS
    MH --> SPS
    MH --> FS
    MH --> FCM
    PH --> PS
    PuH --> SPS
    BalH --> BS

    PS --> UR
    BS --> BR
    SPS --> UR
    SPS --> BR
    FS --> FCM
    FS --> UR

    PS --> CS
    BS --> CS
    SPS --> CS
    FCM --> CS
    RL --> CS
    CB --> CS

    UR --> CFG
    BR --> CFG
    TR --> CFG

    PS --> INT
    BS --> INT
    SPS --> INT
    FS --> INT
    FCM --> INT
    RL --> INT
    CB --> INT

    MH --> DT
    PH --> DT
    PuH --> DT
    BalH --> DT
```

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

- **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π I/O
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å Redis –∫–ª–∞—Å—Ç–µ—Ä–æ–º
- **Circuit Breaker** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–±–æ–µ–≤ –≤–Ω–µ—à–Ω–∏—Ö API
- **Rate Limiting** –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Ä–æ–≤–Ω—è—Ö (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –≥–ª–æ–±–∞–ª—å–Ω—ã–π, burst)
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏** —Å Prometheus –∏ Grafana
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** Fragment cookies
- **Cloudflare –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### ER-–¥–∏–∞–≥—Ä–∞–º–º–∞

```mermaid
erDiagram
    USERS {
        bigint user_id PK "Telegram User ID"
        varchar username "Telegram username"
        varchar first_name "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
        varchar last_name "–§–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
        boolean is_premium "–ü—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å"
        varchar language_code "–ö–æ–¥ —è–∑—ã–∫–∞"
        timestamp created_at "–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è"
        timestamp updated_at "–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"
    }

    BALANCES {
        serial id PK "–£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID"
        bigint user_id FK "ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
        decimal amount "–°—É–º–º–∞ –±–∞–ª–∞–Ω—Å–∞"
        varchar currency "–í–∞–ª—é—Ç–∞ (TON)"
        timestamp created_at "–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è"
        timestamp updated_at "–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"
    }

    TRANSACTIONS {
        serial id PK "–£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID"
        bigint user_id FK "ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
        transaction_type transaction_type "–¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"
        transaction_status status "–°—Ç–∞—Ç—É—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"
        decimal amount "–°—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"
        varchar currency "–í–∞–ª—é—Ç–∞"
        text description "–û–ø–∏—Å–∞–Ω–∏–µ"
        varchar external_id UK "–í–Ω–µ—à–Ω–∏–π ID –ø–ª–∞—Ç–µ–∂–∞"
        jsonb transaction_metadata "–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ JSON"
        timestamp created_at "–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è"
        timestamp updated_at "–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"
    }

    FRAGMENT_COOKIES {
        serial id PK "–£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID"
        varchar session_id "ID —Å–µ—Å—Å–∏–∏ Fragment"
        text cookies "Cookies –¥–∞–Ω–Ω—ã–µ"
        varchar status "–°—Ç–∞—Ç—É—Å cookies"
        timestamp expires_at "–í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è"
        timestamp created_at "–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è"
        timestamp updated_at "–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"
    }

    USERS ||--|| BALANCES : "–∏–º–µ–µ—Ç"
    USERS ||--o{ TRANSACTIONS : "—Å–æ–≤–µ—Ä—à–∞–µ—Ç"
    FRAGMENT_COOKIES ||--o{ TRANSACTIONS : "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è"
```

### –¢–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| `purchase` | –ü–æ–∫—É–ø–∫–∞ –∑–≤–µ–∑–¥ —á–µ—Ä–µ–∑ Fragment API |
| `refund` | –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ |
| `bonus` | –ë–æ–Ω—É—Å–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è |
| `adjustment` | –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –±–∞–ª–∞–Ω—Å–∞ |
| `recharge` | –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ Heleket |

### –°—Ç–∞—Ç—É—Å—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `pending` | –û–∂–∏–¥–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã |
| `processing` | –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ |
| `completed` | –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω |
| `failed` | –û—à–∏–±–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ |
| `cancelled` | –û—Ç–º–µ–Ω–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º |
| `expired` | –ò—Å—Ç–µ–∫ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è |

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|--------|------------|
| **Python** | 3.11+ | –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è |
| **aiogram** | 3.21+ | Telegram Bot Framework |
| **FastAPI** | 0.115+ | REST API –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ |
| **SQLAlchemy** | 2.0+ | ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL |
| **Alembic** | 1.13+ | –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| **asyncpg** | 0.29+ | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä PostgreSQL |
| **Redis** | 6.4+ | –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **fragment-api-lib** | 1.0+ | –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Fragment API |

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|--------|------------|
| **PostgreSQL** | 15+ | –û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| **Redis Cluster** | 7+ | –í—ã—Å–æ–∫–æ–¥–æ—Å—Ç—É–ø–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **Nginx** | latest | Reverse proxy –∏ load balancer |
| **Docker** | latest | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è |
| **Docker Compose** | latest | –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ |
| **Cloudflare Tunnel** | latest | –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º |

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|------------|
| **SSL/TLS** | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π |
| **HMAC** | –ü–æ–¥–ø–∏—Å–∏ –≤–µ–±—Ö—É–∫–æ–≤ |
| **Rate Limiting** | –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ |
| **Circuit Breaker** | –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Å–±–æ—è–º |
| **Prometheus** | –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ |
| **Grafana** | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ |
| **Selenium** | –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è cookies |
| **ChromeDriver** | –ë—Ä–∞—É–∑–µ—Ä–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è |

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|------------|
| **pytest** | Unit –∏ integration —Ç–µ—Å—Ç—ã |
| **pytest-asyncio** | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ |
| **pytest-cov** | –ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞ |
| **colorlog** | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **structlog** | JSON –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **psutil** | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ |

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Python** 3.11 –∏–ª–∏ –≤—ã—à–µ
- **PostgreSQL** 15 –∏–ª–∏ –≤—ã—à–µ
- **Redis** 7 –∏–ª–∏ –≤—ã—à–µ
- **Docker** –∏ Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –ú–∏–Ω–∏–º—É–º 2GB RAM, 4GB —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
- –ú–∏–Ω–∏–º—É–º 2 CPU cores, 4 —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

### –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

#### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd mirza-telegram-shop-bot
```

#### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate     # Windows
```

#### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

#### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

#### 5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
alembic upgrade head

# –ò–ª–∏ —á–µ—Ä–µ–∑ Python
python -c "from repositories.user_repository import UserRepository; import asyncio; repo = UserRepository(); asyncio.run(repo.create_tables())"
```

#### 6. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Fragment API
python scripts/precheck_fragment.py

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Fragment cookies
python scripts/update_fragment_cookies.py
```

#### 7. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
python main.py
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------------------|----------|
| `TELEGRAM_TOKEN` | - | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ |
| `MERCHANT_UUID` | - | UUID –º–µ—Ä—á–∞–Ω—Ç–∞ –≤ Heleket |
| `API_KEY` | - | API –∫–ª—é—á Heleket |
| `DATABASE_URL` | postgresql://user:password@localhost:5432/telegram_bot | URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| `REDIS_URL` | redis://redis-node-1:7379 | URL Redis |

#### Fragment API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------------------|----------|
| `FRAGMENT_SEED_PHRASE` | - | 24-—Å–ª–æ–≤–Ω–∞—è seed —Ñ—Ä–∞–∑–∞ TON –∫–æ—à–µ–ª—å–∫–∞ |
| `FRAGMENT_COOKIES` | - | Cookies –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ |
| `FRAGMENT_AUTO_COOKIE_REFRESH` | false | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies |
| `FRAGMENT_COOKIE_REFRESH_INTERVAL` | 3600 | –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Å–µ–∫) |

#### Rate Limiting –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|----------|
| `RATE_LIMIT_USER_MESSAGES` | 30 | –°–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `RATE_LIMIT_USER_OPERATIONS` | 20 | –û–ø–µ—Ä–∞—Ü–∏–π –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `RATE_LIMIT_USER_PAYMENTS` | 5 | –ü–ª–∞—Ç–µ–∂–µ–π –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `RATE_LIMIT_GLOBAL_MESSAGES` | 1000 | –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π |
| `RATE_LIMIT_PREMIUM_MULTIPLIER` | 2.0 | –ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è –ø—Ä–µ–º–∏—É–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |

#### Cache –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|----------|
| `CACHE_TTL_USER` | 1800 | –ö–µ—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å–µ–∫) |
| `CACHE_TTL_SESSION` | 1800 | –ö–µ—à —Å–µ—Å—Å–∏–π (—Å–µ–∫) |
| `CACHE_TTL_PAYMENT` | 900 | –ö–µ—à –ø–ª–∞—Ç–µ–∂–µ–π (—Å–µ–∫) |
| `CACHE_TTL_RATE_LIMIT` | 60 | –ö–µ—à rate limiting (—Å–µ–∫) |

## üê≥ Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫
git clone <repository-url>
cd mirza-telegram-shop-bot
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª
docker-compose up -d
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```mermaid
graph TB
    subgraph "üåê External Network"
        INTERNET[Internet]
        TG_API[Telegram API]
        HELEKET_API[Heleket API]
        FRAGMENT_API[Fragment API]
    end

    subgraph "üîí Cloudflare Layer"
        CF_TUNNEL[Cloudflare Tunnel]
        CF_WAF[WAF & DDoS Protection]
    end

    subgraph "üö™ DMZ Network"
        NGINX[nginx: Load Balancer & SSL]
    end

    subgraph "üè† Application Network (bot-network)"
        subgraph "Application Services"
            BOT[app: Telegram Bot]
            WEBHOOK[webhook: Webhook Handler]
            API[api: REST API]
        end

        subgraph "Database Services"
            POSTGRES[db: PostgreSQL 15]
        end

        subgraph "Cache Services"
            REDIS1[redis-node-1: Redis 7]
            REDIS2[redis-node-2: Redis 7]
            REDIS3[redis-node-3: Redis 7]
            REDIS_REPLICA1[redis-replica-1]
            REDIS_REPLICA2[redis-replica-2]
            REDIS_REPLICA3[redis-replica-3]
        end

        subgraph "Monitoring"
            PROMETHEUS[prometheus: Metrics]
            GRAFANA[grafana: Dashboards]
        end

        subgraph "Utilities"
            REDIS_CREATOR[redis-cluster-creator]
            REDIS_MONITOR[redis-cluster-monitor]
        end
    end

    INTERNET --> CF_TUNNEL
    TG_API --> CF_WAF
    HELEKET_API --> CF_WAF
    FRAGMENT_API --> CF_WAF

    CF_TUNNEL --> CF_WAF
    CF_WAF --> NGINX

    NGINX --> BOT
    NGINX --> WEBHOOK
    NGINX --> API

    BOT --> POSTGRES
    WEBHOOK --> POSTGRES
    API --> POSTGRES

    BOT --> REDIS1
    WEBHOOK --> REDIS1
    API --> REDIS1

    REDIS1 --> REDIS_REPLICA1
    REDIS2 --> REDIS_REPLICA2
    REDIS3 --> REDIS_REPLICA3

    PROMETHEUS --> BOT
    PROMETHEUS --> WEBHOOK
    PROMETHEUS --> API
    PROMETHEUS --> POSTGRES
    PROMETHEUS --> REDIS1

    GRAFANA --> PROMETHEUS
```

### Docker —Å–µ—Ä–≤–∏—Å—ã

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ—Å—É—Ä—Å—ã |
|--------|------|----------|---------|
| **app** | - | –û—Å–Ω–æ–≤–Ω–æ–π Telegram –±–æ—Ç | 512MB RAM, 0.5 CPU |
| **webhook** | 8001 | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–µ–±—Ö—É–∫–æ–≤ | 256MB RAM, 0.2 CPU |
| **api** | 8002 | REST API —Å–µ—Ä–≤–∏—Å | 256MB RAM, 0.2 CPU |
| **db** | 5432 | PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | 1GB RAM, 1 CPU |
| **nginx** | 80, 443 | Load balancer –∏ SSL | 128MB RAM, 0.1 CPU |
| **redis-node-1** | 7379 | Redis –∫–ª–∞—Å—Ç–µ—Ä —É–∑–µ–ª 1 | 256MB RAM, 0.2 CPU |
| **redis-node-2** | 7380 | Redis –∫–ª–∞—Å—Ç–µ—Ä —É–∑–µ–ª 2 | 256MB RAM, 0.2 CPU |
| **redis-node-3** | 7381 | Redis –∫–ª–∞—Å—Ç–µ—Ä —É–∑–µ–ª 3 | 256MB RAM, 0.2 CPU |
| **prometheus** | 9090 | –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ | 256MB RAM, 0.1 CPU |
| **grafana** | 3000 | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ | 256MB RAM, 0.1 CPU |

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Fragment cookies

Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Chrome –∏ ChromeDriver** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
2. **–û–±–Ω–æ–≤–ª—è–µ—Ç Fragment cookies** –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
3. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç cookies** –≤ —Ñ–æ–Ω–µ
4. **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç cookies** –≤ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
5. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å Fragment API** –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è cookies
docker-compose logs app | grep -i fragment

# –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies
docker-compose exec app python scripts/update_fragment_cookies.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Fragment API
docker-compose exec app python scripts/check_fragment_status.py
```

## üì° API –∏ –í–µ–±—Ö—É–∫–∏

### Webhook —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –≠–Ω–¥–ø–æ–∏–Ω—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
|----------|-------|----------|----------------|
| `/webhook/heleket` | POST | –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π Heleket | HMAC –ø–æ–¥–ø–∏—Å—å |
| `/webhook/telegram` | POST | –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Telegram | –°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω |
| `/health` | GET | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ | - |
| `/health/detailed` | GET | –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ | - |
| `/metrics` | GET | Prometheus –º–µ—Ç—Ä–∏–∫–∏ | - |
| `/api/v1/users/{user_id}/balance` | GET | –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | JWT —Ç–æ–∫–µ–Ω |
| `/api/v1/transactions` | GET | –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | JWT —Ç–æ–∫–µ–Ω |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–µ–±—Ö—É–∫–∞ Heleket

```json
{
  "uuid": "payment_uuid_here",
  "status": "completed",
  "amount": "100.00",
  "currency": "TON",
  "external_id": "user_12345_stars_100",
  "created_at": "2024-01-01T12:00:00Z",
  "metadata": {
    "user_id": 12345,
    "stars_count": 100,
    "purchase_type": "balance"
  }
}
```

### –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç–µ–∂–µ–π

```mermaid
sequenceDiagram
    participant U as üë§ User
    participant TB as ü§ñ Telegram Bot
    participant PS as üí≥ Payment Service
    participant H as üè¶ Heleket API
    participant WH as üîó Webhook Handler
    participant DB as üóÑÔ∏è Database
    participant C as üì¶ Redis Cache

    U->>TB: /buy_stars 100
    TB->>PS: create_payment_request(user_id, 100)
    PS->>DB: create_transaction(pending)
    PS->>C: cache_payment(uuid, user_id)
    PS->>H: POST /create_payment
    H-->>PS: payment_url + uuid
    PS-->>TB: payment_url
    TB-->>U: üí≥ –°—Å—ã–ª–∫–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã

    Note over U,H: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ –∏ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç

    H->>WH: POST /webhook/heleket (payment completed)
    WH->>C: get_payment_info(uuid)
    WH->>DB: update_transaction(completed)
    WH->>DB: update_user_balance(+100)
    WH->>C: invalidate_user_cache(user_id)
    WH->>TB: notify_payment_success(user_id)
    TB->>U: ‚úÖ –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–µ–Ω! +100 ‚≠ê
```

### Rate Limiting –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph LR
    subgraph "Rate Limiting Layers"
        UL[üë§ User Limits]
        GL[üåç Global Limits]
        BL[‚ö° Burst Limits]
        PL[‚≠ê Premium Limits]
        NL[üÜï New User Limits]
    end

    subgraph "Limit Types"
        MSG[üì® Messages: 30/min]
        OPS[‚öôÔ∏è Operations: 20/min]
        PAY[üí≥ Payments: 5/min]
        API[üîå API calls: 10/min]
    end

    subgraph "Storage"
        REDIS[(Redis Cluster)]
        LOCAL[Local Cache]
    end

    UL --> MSG
    UL --> OPS
    UL --> PAY
    UL --> API

    GL --> MSG
    GL --> OPS
    GL --> PAY
    GL --> API

    BL --> MSG
    BL --> OPS

    PL --> UL
    NL --> UL

    MSG --> REDIS
    OPS --> REDIS
    PAY --> REDIS
    API --> REDIS

    REDIS --> LOCAL
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### Circuit Breaker –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|----------|
| `CIRCUIT_BREAKER_FAILURE_THRESHOLD` | 5 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–±–æ–µ–≤ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è |
| `CIRCUIT_BREAKER_TIMEOUT` | 60 | –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è |
| `CIRCUIT_BREAKER_SUCCESS_THRESHOLD` | 3 | –£—Å–ø–µ—Ö–æ–≤ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è |

#### SSL/TLS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|----------|
| `SSL_CERT_PATH` | ./ssl/cert.pem | –ü—É—Ç—å –∫ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É |
| `SSL_KEY_PATH` | ./ssl/key.pem | –ü—É—Ç—å –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–ª—é—á—É |
| `SSL_CA_PATH` | ./ssl/ca.pem | –ü—É—Ç—å –∫ CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É |

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|----------|
| `METRICS_ENABLED` | true | –í–∫–ª—é—á–∏—Ç—å —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ |
| `HEALTH_CHECK_INTERVAL` | 30 | –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è |
| `LOG_LEVEL` | INFO | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è |

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ Prometheus

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|----------|
| `telegram_bot_messages_total` | Counter | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π |
| `telegram_bot_payments_total` | Counter | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–ª–∞—Ç–µ–∂–µ–π |
| `telegram_bot_errors_total` | Counter | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ |
| `telegram_bot_active_users` | Gauge | –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ |
| `telegram_bot_response_time_seconds` | Histogram | –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API |
| `telegram_bot_rate_limit_hits` | Counter | –ü–æ–ø—ã—Ç–∫–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ |

### Health Checks

```bash
# –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl https://your-domain.com/health

# –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
curl https://your-domain.com/health/detailed

# –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
curl https://your-domain.com/metrics
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

- **DEBUG** - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **INFO** - –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ
- **WARNING** - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö
- **ERROR** - –û—à–∏–±–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **CRITICAL** - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

#### –§–æ—Ä–º–∞—Ç—ã –ª–æ–≥–æ–≤

- **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞**: –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Å —Ü–≤–µ—Ç–∞–º–∏
- **Production**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON —Ñ–æ—Ä–º–∞—Ç

#### –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤

- **–ü–æ —Ä–∞–∑–º–µ—Ä—É**: –ú–∞–∫—Å–∏–º—É–º 100MB –Ω–∞ —Ñ–∞–π–ª
- **–ü–æ –≤—Ä–µ–º–µ–Ω–∏**: –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è
- **–°–∂–∞—Ç–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```mermaid
graph TD
    subgraph "üß™ Test Structure"
        TESTS["üìÅ tests/"]

        subgraph "üî¨ Unit Tests"
            UNIT[("üìÅ unit/")]
            UNIT_SERVICES["üìÅ test_services/"]
            UNIT_REPOS["üìÅ test_repositories/"]
            UNIT_HANDLERS["üìÅ test_handlers/"]
            UNIT_UTILS["üìÅ test_utils/"]
        end

        subgraph "üîó Integration Tests"
            INTEGRATION[("üìÅ integration/")]
            INT_PAYMENT["üìÅ test_payment_flow/"]
            INT_WEBHOOK["üìÅ test_webhook_processing/"]
            INT_FRAGMENT["üìÅ test_fragment_integration/"]
            INT_CACHE["üìÅ test_cache_operations/"]
        end

        subgraph "üõ†Ô∏è Test Fixtures"
            FIXTURES[("üìÅ fixtures/")]
            FIX_DB["üìÑ database.py"]
            FIX_REDIS["üìÑ redis.py"]
            FIX_MOCKS["üìÑ mocks.py"]
        end
    end

    TESTS --> UNIT
    TESTS --> INTEGRATION
    TESTS --> FIXTURES

    UNIT --> UNIT_SERVICES
    UNIT --> UNIT_REPOS
    UNIT --> UNIT_HANDLERS
    UNIT --> UNIT_UTILS

    INTEGRATION --> INT_PAYMENT
    INTEGRATION --> INT_WEBHOOK
    INTEGRATION --> INT_FRAGMENT
    INTEGRATION --> INT_CACHE

    FIXTURES --> FIX_DB
    FIXTURES --> FIX_REDIS
    FIXTURES --> FIX_MOCKS
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
pytest --cov=. --cov-report=html

# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
pytest tests/unit/

# –¢–æ–ª—å–∫–æ integration —Ç–µ—Å—Ç—ã
pytest tests/integration/

# –¢–µ—Å—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
pytest tests/unit/test_services/
pytest tests/integration/test_payment_flow/

# –¢–µ—Å—Ç—ã Fragment API
pytest tests/test_fragment_service.py
pytest tests/test_fragment_cookie_manager.py
pytest tests/integration/test_fragment_integration/
```

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### Unit —Ç–µ—Å—Ç—ã

```python
# –ü—Ä–∏–º–µ—Ä unit —Ç–µ—Å—Ç–∞ –¥–ª—è PaymentService
import pytest
from services.payment.payment_service import PaymentService

class TestPaymentService:
    @pytest.mark.asyncio
    async def test_create_payment_success(self, mock_heleket_api):
        service = PaymentService()
        result = await service.create_payment(user_id=123, amount=100)

        assert result["status"] == "success"
        assert "payment_url" in result
        assert "uuid" in result

    @pytest.mark.asyncio
    async def test_create_payment_invalid_amount(self):
        service = PaymentService()

        with pytest.raises(ValueError, match="Invalid amount"):
            await service.create_payment(user_id=123, amount=-100)
```

#### Integration —Ç–µ—Å—Ç—ã

```python
# –ü—Ä–∏–º–µ—Ä integration —Ç–µ—Å—Ç–∞
@pytest.mark.asyncio
async def test_full_payment_flow(test_client, test_db):
    # 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
    response = await test_client.post("/api/v1/payments", json={
        "user_id": 123,
        "amount": 100,
        "currency": "TON"
    })
    assert response.status_code == 200
    payment_data = response.json()

    # 2. –°–∏–º—É–ª—è—Ü–∏—è –≤–µ–±—Ö—É–∫–∞
    webhook_data = {
        "uuid": payment_data["uuid"],
        "status": "completed",
        "amount": "100.00"
    }
    response = await test_client.post("/webhook/heleket", json=webhook_data)
    assert response.status_code == 200

    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
    response = await test_client.get("/api/v1/users/123/balance")
    assert response.status_code == 200
    balance_data = response.json()
    assert balance_data["amount"] == 100
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

–ü—Ä–æ–µ–∫—Ç —Å—Ç—Ä–µ–º–∏—Ç—Å—è –∫ –ø–æ–∫—Ä—ã—Ç–∏—é –∫–æ–¥–∞ –Ω–µ –º–µ–Ω–µ–µ 80%:

- **Unit —Ç–µ—Å—Ç—ã**: 85% –ø–æ–∫—Ä—ã—Ç–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **Integration —Ç–µ—Å—Ç—ã**: 75% –ø–æ–∫—Ä—ã—Ç–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
- **API —Ç–µ—Å—Ç—ã**: 90% –ø–æ–∫—Ä—ã—Ç–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

```mermaid
graph TD
    A[üöÄ Deployment Trigger] --> B[üîç Pre-deployment Checks]
    B --> C[üì¶ Build Docker Images]
    C --> D[üß™ Run Tests]
    D --> E[üîê Security Scan]
    E --> F[üìã Configuration Validation]
    F --> G{üåø Environment?}

    G -->|Staging| H[üöÄ Deploy to Staging]
    G -->|Production| I[üîÑ Blue-Green Deployment]

    H --> J[üß™ Staging Tests]
    J --> K[‚úÖ Staging Approval]
    K --> I

    I --> L[üîç Health Checks]
    L --> M[üìä Performance Monitoring]
    M --> N{‚úÖ Success?}

    N -->|Yes| O[üîÑ Switch Traffic]
    N -->|No| P[üîô Rollback]

    O --> Q[üß™ Post-deployment Tests]
    Q --> R[üì¢ Notification]
    R --> S[‚úÖ Deployment Complete]

    P --> T[üì¢ Alert Team]
    T --> S
```

### CI/CD Pipeline

#### GitOps –ø—Ä–æ—Ü–µ—Å—Å

```mermaid
gitGraph
    commit id: "Initial commit"
    branch develop
    checkout develop
    commit id: "feat: add payment processing"
    commit id: "fix: rate limiting bug"
    commit id: "refactor: optimize cache usage"
    checkout main
    merge develop
    commit id: "Release v2.1.0"
    branch hotfix
    checkout hotfix
    commit id: "fix: critical payment bug"
    checkout main
    merge hotfix
    commit id: "Release v2.1.1"
    branch feature/new-payment-method
    checkout feature/new-payment-method
    commit id: "feat: add Stripe integration"
    commit id: "test: add Stripe payment tests"
    checkout develop
    merge feature/new-payment-method
    checkout main
    merge develop
    commit id: "Release v2.2.0"
```

#### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```yaml
# .github/workflows/deploy.yml
name: Deploy to Production
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run tests
        run: |
          python -m venv venv
          source venv/bin/activate
          pip install -r requirements.txt
          pytest --cov=. --cov-report=xml

  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Security scan
        uses: github/super-linter@v4

  deploy:
    needs: [test, security]
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to production
        run: |
          echo "Deploying to production..."
          # Deployment commands here
```

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

```mermaid
graph TB
    subgraph "Load Balancer"
        LB[Load Balancer]
    end

    subgraph "Application Cluster"
        APP1[App Instance 1]
        APP2[App Instance 2]
        APP3[App Instance 3]
        APP4[App Instance 4]
    end

    subgraph "Database Layer"
        PRIMARY[(PostgreSQL Primary)]
        REPLICA1[(Replica 1)]
        REPLICA2[(Replica 2)]
    end

    subgraph "Cache Layer"
        REDIS[(Redis Cluster)]
    end

    LB --> APP1
    LB --> APP2
    LB --> APP3
    LB --> APP4

    APP1 --> PRIMARY
    APP2 --> REPLICA1
    APP3 --> REPLICA2
    APP4 --> PRIMARY

    APP1 --> REDIS
    APP2 --> REDIS
    APP3 --> REDIS
    APP4 --> REDIS

    PRIMARY -.-> REPLICA1
    PRIMARY -.-> REPLICA2
```

#### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

```mermaid
graph TB
    subgraph "Enhanced Instance"
        APP[Enhanced App]
        subgraph "Resource Optimization"
            CPU[CPU Optimization]
            MEM[Memory Management]
            IO[I/O Optimization]
        end
        subgraph "Connection Pooling"
            DB_POOL[Database Pool]
            CACHE_POOL[Cache Pool]
            API_POOL[API Pool]
        end
        subgraph "Async Processing"
            TASK_QUEUE[Task Queue]
            WORKER_POOL[Worker Pool]
            BG_JOBS[Background Jobs]
        end
    end

    APP --> CPU
    APP --> MEM
    APP --> IO

    APP --> DB_POOL
    APP --> CACHE_POOL
    APP --> API_POOL

    APP --> TASK_QUEUE
    TASK_QUEUE --> WORKER_POOL
    TASK_QUEUE --> BG_JOBS
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
mirza-telegram-shop-bot/
‚îú‚îÄ‚îÄ üìÅ alembic/                    # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ alembic.ini
‚îÇ   ‚îú‚îÄ‚îÄ env.py
‚îÇ   ‚îî‚îÄ‚îÄ versions/
‚îú‚îÄ‚îÄ üìÅ cloudflare/                 # Cloudflare –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ cloudflared-credentials.json.example
‚îÇ   ‚îú‚îÄ‚îÄ cloudflared.json.example
‚îÇ   ‚îî‚îÄ‚îÄ cloudflared-cert.pem
‚îú‚îÄ‚îÄ üìÅ config/                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ settings.py
‚îú‚îÄ‚îÄ üìÅ core/                       # –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ interfaces.py
‚îú‚îÄ‚îÄ üìÅ docs/                       # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ ARCHITECTURE.md
‚îÇ   ‚îú‚îÄ‚îÄ DEPLOYMENT.md
‚îÇ   ‚îî‚îÄ‚îÄ SSL_SETUP.md
‚îú‚îÄ‚îÄ üìÅ handlers/                   # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Telegram
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ balance_handler.py
‚îÇ   ‚îú‚îÄ‚îÄ base_handler.py
‚îÇ   ‚îú‚îÄ‚îÄ error_handler.py
‚îÇ   ‚îú‚îÄ‚îÄ message_handler.py
‚îÇ   ‚îú‚îÄ‚îÄ payment_handler.py
‚îÇ   ‚îî‚îÄ‚îÄ purchase_handler.py
‚îú‚îÄ‚îÄ üìÅ nginx/                      # Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ conf.d/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ssl.conf
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf
‚îú‚îÄ‚îÄ üìÅ redis/                      # Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ conf/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ redis.conf
‚îÇ   ‚îî‚îÄ‚îÄ scripts/
‚îÇ       ‚îú‚îÄ‚îÄ create_cluster.sh
‚îÇ       ‚îî‚îÄ‚îÄ monitor_cluster_new.sh
‚îú‚îÄ‚îÄ üìÅ repositories/               # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ balance_repository.py
‚îÇ   ‚îî‚îÄ‚îÄ user_repository.py
‚îú‚îÄ‚îÄ üìÅ scripts/                    # –°–∫—Ä–∏–ø—Ç—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ check_fragment_status.py
‚îÇ   ‚îú‚îÄ‚îÄ periodic_cookie_refresher.py
‚îÇ   ‚îú‚îÄ‚îÄ precheck_fragment.py
‚îÇ   ‚îú‚îÄ‚îÄ ssl-renewal.sh
‚îÇ   ‚îú‚îÄ‚îÄ update_fragment_cookies.py
‚îÇ   ‚îî‚îÄ‚îÄ cron/
‚îÇ       ‚îî‚îÄ‚îÄ ssl-renewal.cron
‚îú‚îÄ‚îÄ üìÅ services/                   # –ë–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ balance/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ balance_service.py
‚îÇ   ‚îú‚îÄ‚îÄ cache/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment_cache.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rate_limit_cache.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session_cache.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user_cache.py
‚îÇ   ‚îú‚îÄ‚îÄ fragment/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fragment_cookie_manager.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fragment_service.py
‚îÇ   ‚îú‚îÄ‚îÄ payment/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment_service.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ star_purchase_service.py
‚îÇ   ‚îú‚îÄ‚îÄ system/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ advanced_rate_limiter.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ circuit_breaker.py
‚îÇ   ‚îî‚îÄ‚îÄ webhook/
‚îÇ       ‚îú‚îÄ‚îÄ webhook_app.py
‚îÇ       ‚îî‚îÄ‚îÄ webhook_handler.py
‚îú‚îÄ‚îÄ üìÅ tests/                      # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_fragment_cookie_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ test_fragment_service.py
‚îÇ   ‚îú‚îÄ‚îÄ test_periodic_cookie_refresher.py
‚îÇ   ‚îú‚îÄ‚îÄ test_precheck_fragment.py
‚îÇ   ‚îú‚îÄ‚îÄ test_seed_phrase.py
‚îÇ   ‚îú‚îÄ‚îÄ test_star_purchase_fragment.py
‚îÇ   ‚îî‚îÄ‚îÄ test_precheck_fragment.py
‚îú‚îÄ‚îÄ üìÅ utils/                      # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ message_templates.py
‚îÇ   ‚îî‚îÄ‚îÄ rate_limit_messages.py
‚îú‚îÄ‚îÄ üîß Dockerfile                 # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ üîß docker-compose.yml         # Docker –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ üîß main.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ üîß requirements.txt           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ üîß .env.example               # –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ üîß .gitignore                 # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã
‚îî‚îÄ‚îÄ üìñ README.md                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
```

### –û–ø–∏—Å–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

| –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|
| `handlers/` | –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π Telegram |
| `services/` | –ë–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ API |
| `repositories/` | –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏ –∫–µ—à–µ–º |
| `config/` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| `core/` | –ê–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã |
| `scripts/` | –°–∫—Ä–∏–ø—Ç—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ |
| `tests/` | Unit –∏ integration —Ç–µ—Å—Ç—ã |
| `docs/` | –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

### –ü—Ä–æ—Ü–µ—Å—Å –≤–Ω–µ—Å–µ–Ω–∏—è –≤–∫–ª–∞–¥–∞

1. **–§–æ—Ä–∫ –ø—Ä–æ–µ–∫—Ç–∞**
   ```bash
   git clone https://github.com/your-username/mirza-telegram-shop-bot.git
   ```

2. **–°–æ–∑–¥–∞–Ω–∏–µ feature –≤–µ—Ç–∫–∏**
   ```bash
   git checkout -b feature/amazing-feature
   ```

3. **–í–Ω–µ—Å–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π**
   - –°–ª–µ–¥—É–π—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º SOLID –∏ DRY
   - –î–æ–±–∞–≤–ª—è–π—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞
   - –û–±–Ω–æ–≤–ª—è–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
   - –°–æ–±–ª—é–¥–∞–π—Ç–µ —Å—Ç–∏–ª—å –∫–æ–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   ```bash
   pytest --cov=. --cov-report=html
   ```

5. **–ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π**
   ```bash
   git add .
   git commit -m "feat: add amazing feature"
   ```

6. **Push –∏ Pull Request**
   ```bash
   git push origin feature/amazing-feature
   # –°–æ–∑–¥–∞–π—Ç–µ Pull Request –Ω–∞ GitHub
   ```

### –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–æ–¥–∞

#### –°—Ç–∏–ª—å –∫–æ–¥–∞

- **PEP 8** - —Å—Ç–∏–ª—å –∫–æ–¥–∞ Python
- **–¢–∏–ø–∏–∑–∞—Ü–∏—è** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ type hints
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - docstrings –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- **–õ–∏–Ω—Ç–µ—Ä—ã** - black, flake8, mypy

#### –ö–æ–º–º–∏—Ç—ã

```
feat: add new payment method
fix: resolve rate limiting bug
docs: update API documentation
refactor: optimize database queries
test: add unit tests for payment service
```

#### Pull Request

- **–ó–∞–≥–æ–ª–æ–≤–æ–∫**: –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –∏ –ø–æ–∫—Ä—ã—Ç–∏–µ
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **Breaking Changes**: –ï—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
git clone https://github.com/username/mirza-telegram-shop-bot.git
cd mirza-telegram-shop-bot

# –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv
source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
pip install -e .[dev]

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pre-commit hooks
pre-commit install

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
python main.py
```

#### –û—Ç–ª–∞–¥–∫–∞

```bash
# –° –æ—Ç–ª–∞–¥–∫–æ–π
DEBUG=true python main.py

# –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
LOG_LEVEL=DEBUG python main.py

# –° –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º
python -m cProfile main.py
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏

1. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é](docs/) –ø—Ä–æ–µ–∫—Ç–∞
2. **Issues**: –ü–æ–∏—â–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –≤ [GitHub Issues](../../issues)
3. **Discussions**: –û–±—Å—É–¥–∏—Ç–µ –≤ [GitHub Discussions](../../discussions)
4. **Telegram**: –°–≤—è–∂–∏—Ç–µ—Å—å —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º @Mirza

### –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Issue —É–∫–∞–∂–∏—Ç–µ:

- **–í–µ—Ä—Å–∏—é Python –∏ –û–°**
- **–í–µ—Ä—Å–∏–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
- **–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏**
- **–®–∞–≥–∏ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è**
- **–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** (–±–µ–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

```markdown
## –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏

## –®–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
1. 
2. 
3. 

## –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

## –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

## –õ–æ–≥–∏

## –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- Python –≤–µ—Ä—Å–∏—è:
- –û–°:
- Docker –≤–µ—Ä—Å–∏—è:
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–ü—Ä–æ–µ–∫—Ç –ø—Ä–æ—à–µ–ª –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

- ‚úÖ **Input Validation** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **SQL Injection Protection** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ORM
- ‚úÖ **XSS Protection** - —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚úÖ **CSRF Protection** - –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫
- ‚úÖ **Rate Limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç DoS –∞—Ç–∞–∫
- ‚úÖ **SSL/TLS** - —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ **HMAC Signatures** - –ø–æ–¥–ø–∏—Å–∏ –≤–µ–±—Ö—É–∫–æ–≤
- ‚úÖ **Environment Variables** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
- ‚úÖ **Seed Phrase Protection** - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ seed —Ñ—Ä–∞–∑
- ‚úÖ **Cookie Management** - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ cookies
- ‚úÖ **Pre-flight Checks** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–•—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º –º–µ—Å—Ç–µ**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HashiCorp Vault –∏–ª–∏ AWS Secrets Manager
   - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—Ç–µ `.env` —Ñ–∞–π–ª—ã
   - –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Ç–æ–∫–µ–Ω—ã

2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º—É**
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
   - –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏
   - –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

3. **–û–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
   - –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ Python –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
   - –°–ª–µ–¥–∏—Ç–µ –∑–∞ security advisories
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Dependabot –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

4. **–°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ firewall
   - –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç–∞–º
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ VPN –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

5. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –†–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –±—ç–∫–∞–ø—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   - –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
   - –•—Ä–∞–Ω–∏—Ç–µ –±—ç–∫–∞–ø—ã –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º –º–µ—Å—Ç–µ

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - –≤—Å–µ I/O –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ
- **Connection Pooling** - –ø—É–ª—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è –ë–î –∏ Redis
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (L1 + L2)
- **Rate Limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏
- **Circuit Breaker** - —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Å–±–æ—è–º –≤–Ω–µ—à–Ω–∏—Ö API
- **Database Indexing** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- **Query Optimization** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|----------|
| **Response Time** | < 100ms | –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API |
| **Throughput** | 1000+ req/min | –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å |
| **Error Rate** | < 0.1% | –ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫ |
| **Cache Hit Rate** | > 95% | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è |
| **Database Latency** | < 10ms | –ó–∞–¥–µ—Ä–∂–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

```yaml
# docker-compose.scale.yml
version: '3.8'
services:
  app:
    image: mirza-telegram-shop-bot:latest
    deploy:
      replicas: 3
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.2'
          memory: 256M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 120s
    environment:
      - REDIS_URL=redis://redis-cluster:7000
      - DATABASE_URL=postgresql://user:pass@postgres-primary:5432/db
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –°–º. —Ñ–∞–π–ª `LICENSE` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- **aiogram** - –º–æ—â–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram –±–æ—Ç–æ–≤
- **FastAPI** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL** - –Ω–∞–¥–µ–∂–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Redis** - –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **Cloudflare** - –∑–∞—â–∏—Ç–∞ –∏ –¥–æ—Å—Ç–∞–≤–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

---

**–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ Telegram —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-01-27*
