# Telegram Bot —Å –ü–æ–∫—É–ø–∫–æ–π –ó–≤–µ–∑–¥ v2.0

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∑–≤–µ–∑–¥ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π Heleket. –ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker Compose, Redis –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ –≤—ã—Å–æ–∫–æ–¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

## üéâ –í–µ—Ä—Å–∏—è 2.0 - –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π** - –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ handlers/message_handler.py —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º SOLID –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤
- **–°–∏—Å—Ç–µ–º–∞ —Å–µ—Å—Å–∏–π** - —É–ª—É—á—à–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **Rate limiting** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π
- **Circuit breaker** - –∑–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –æ—Ç–∫–∞–∑–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- **–£–ª—É—á—à–µ–Ω–Ω—ã–π UI/UX** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —ç–º–æ–¥–∑–∏ –∏ HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è** - –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ–Ω—é
- **–£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö** - –ø–æ–Ω—è—Ç–Ω—ã–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è** - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–ª–∞–Ω—Å–µ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- **–ù–æ–≤—ã–µ callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫
- **–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** - –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π

## üÜï –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ v2.0

### üí´ –û—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

- **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω —Å —ç–º–æ–¥–∑–∏ –∏ —á–µ—Ç–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω –±–∞–ª–∞–Ω—Å–∞** - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–ª–∞–Ω—Å–µ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö
- **–£–ª—É—á—à–µ–Ω–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω –∑–≤–µ–∑–¥** - –æ–ø–∏—Å–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ —Å –±–æ–Ω—É—Å–∞–º–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± —ç–∫–æ–Ω–æ–º–∏–∏
- **–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** - –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π
- **–£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö** - –ø–æ–Ω—è—Ç–Ω—ã–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
- **–£–ª—É—á—à–µ–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫

### üéØ –°–∏—Å—Ç–µ–º–∞ —Å–µ—Å—Å–∏–π –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏** - —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ—Å—Å–∏–π
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ Redis** - –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–∑–≤—Ä–∞—Ç –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### üîÑ Callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

- **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–Ω–æ–ø–æ–∫** - –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–µ –º–µ–Ω—é** - –ª–æ–≥–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–æ–∑–≤—Ä–∞—Ç–æ–º –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –º–µ–Ω—é
- **–í–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏** - —ç–º–æ–¥–∑–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–º–ø–æ–Ω–æ–≤–∫–∞** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

### üõ°Ô∏è –°–∏—Å—Ç–µ–º—ã –∑–∞—â–∏—Ç—ã

- **Rate limiting** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º–∏ –ª–∏–º–∏—Ç–∞–º–∏
- **Circuit breaker** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –æ—Ç–∫–∞–∑–æ–≤ —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- **Graceful degradation** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- **Retry logic** - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö

### ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - User Cache, Payment Cache, Session Cache, Rate Limit Cache
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç async/await –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **Connection pooling** - –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å PostgreSQL –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **Batch operations** - –≥—Ä—É–ø–ø–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- **Redis –∫–ª–∞—Å—Ç–µ—Ä** - 3 –Ω–æ–¥—ã (master + 2 slaves) –¥–ª—è –≤—ã—Å–æ–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- **Nginx reverse proxy** - SSL/TLS —Ç–µ—Ä–º–∏–Ω–∞—Ü–∏—è –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
- **Circuit breaker** - –∑–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –æ—Ç–∫–∞–∑–æ–≤
- **Rate limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- **Health checks** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä—Ç—ã** - 8080/8443/8001/8081 –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

- **PostgreSQL (Neon) + Redis** - –Ω–∞–¥–µ–∂–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è** - –ª–µ–≥–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–£–ª—É—á—à–µ–Ω–Ω—ã–π UI/UX** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —ç–º–æ–¥–∑–∏ –∏ HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **–í–∏–∑—É–∞–ª—å–Ω–æ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω** - –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–∫–µ—Ç–∞—Ö** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –∏ –≤—ã–≥–æ–¥
- **–£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö** - –ø–æ–Ω—è—Ç–Ω—ã–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è** - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–ª–∞–Ω—Å–µ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph TB
    subgraph "External Layer"
        TG[Telegram API] --> NG[Nginx Reverse Proxy]
        NG --> NGINX_SSL[Nginx SSL:8443]
        NG --> NGINX_HTTP[Nginx HTTP:8080]
    end

    subgraph "Application Layer"
        NGINX_SSL --> APP[Telegram Bot App:8001]
        NGINX_HTTP --> APP
        APP --> CB[Circuit Breaker]
        CB --> RL[Rate Limiter]
    end

    subgraph "Cache Layer"
        RL --> RC[Redis Cluster]
        RC --> RM[Redis Master:7379]
        RC --> RS1[Redis Slave 1:7380]
        RC --> RS2[Redis Slave 2:7381]
        RC --> RR1[Redis Replica 1:7382]
        RC --> RR2[Redis Replica 2:7383]
        RC --> RR3[Redis Replica 3:7384]

        APP --> UC[User Cache Service]
        APP --> SC[Session Cache Service]
        APP --> PC[Payment Cache Service]
        APP --> RLC[Rate Limit Cache]

        UC --> RC
        SC --> RC
        PC --> RC
        RLC --> RC
    end

    subgraph "Data Layer"
        APP --> US[User Service]
        APP --> PS[Payment Service]
        APP --> HS[Health Service]
        APP --> WS[WebSocket Service]

        US --> PG[(PostgreSQL Neon)]
        PS --> PG
        HS --> PG
        WS --> PG
    end

    subgraph "Monitoring"
        HS --> HC[Health Checks]
        HC --> APP
        HC --> RC
        HC --> PG
    end

    subgraph "Infrastructure Services"
        DC[Docker Compose]
        AL[Alembic Migrations]
        AL --> PG
    end
```

### –°–µ—Ç–µ–≤–∞—è —Ç–æ–ø–æ–ª–æ–≥–∏—è

```mermaid
graph LR
    subgraph "Ports Configuration"
        P1[8080: HTTP] --> NGINX
        P2[8443: HTTPS] --> NGINX
        P3[8001: Webhook Port] --> WEBHOOK
        P4[8081: App Port] --> APP
        P5[7379: Redis Master] --> REDIS_M
        P6[7380: Redis Node 2] --> REDIS_N2
        P7[7381: Redis Node 3] --> REDIS_N3
        P8[7382: Redis Replica 1] --> REDIS_R1
        P9[7383: Redis Replica 2] --> REDIS_R2
        P10[7384: Redis Replica 3] --> REDIS_R3
    end
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç v2.0

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Python 3.11+** - –æ—Å–Ω–æ–≤–Ω–∞—è —Å—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **Docker & Docker Compose** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **Redis Cluster** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—á–µ—Ä–µ–¥–∏
- **PostgreSQL (Neon)** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Nginx** - reverse proxy

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd telegram-bot
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
chmod +x ssl/generate-ssl.sh
./ssl/generate-ssl.sh

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
chmod 600 .env
chmod 600 ssl/*.pem
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env` —Å —É—á–µ—Ç–æ–º –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π:

```env
# === Telegram Bot Configuration ===
TELEGRAM_TOKEN=your_telegram_bot_token_here
WEBHOOK_HOST=your-domain.com
WEBHOOK_PORT=8001
WEBHOOK_PATH=/webhook

# === Payment System - Heleket Configuration ===
MERCHANT_UUID=your_merchant_uuid_here
API_KEY=your_api_key_here
PAYMENT_TIMEOUT=300

# === Database Configuration (Neon PostgreSQL) ===
DATABASE_URL=postgresql+asyncpg://username:password@host.neon.tech/database?ssl=require
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=30

# === Redis Cluster Configuration ===
REDIS_MASTER_HOST=redis-node-1
REDIS_MASTER_PORT=7379
REDIS_SLAVE1_HOST=redis-node-2
REDIS_SLAVE1_PORT=7380
REDIS_SLAVE2_HOST=redis-node-3
REDIS_SLAVE2_PORT=7381
REDIS_PASSWORD=your_redis_password
REDIS_CLUSTER_ENABLED=True

# === Circuit Breaker Configuration ===
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_RECOVERY_TIMEOUT=60
CIRCUIT_BREAKER_EXPECTED_EXCEPTION=Exception

# === Rate Limiting Configuration ===
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_BURST=10

# === Session Management Configuration ===
SESSION_CACHE_TTL=1800
USER_CACHE_TTL=1800
PAYMENT_CACHE_TTL=900

# === Balance Service Configuration ===
BALANCE_SERVICE_ENABLED=True
BALANCE_PURCHASE_ENABLED=True
MIN_BALANCE_PURCHASE_AMOUNT=1
MAX_BALANCE_PURCHASE_AMOUNT=10000

# === Application Configuration ===
DEBUG=False
LOG_LEVEL=INFO
ENVIRONMENT=production
HEALTH_CHECK_INTERVAL=30

# === SSL Configuration ===
SSL_CERT_PATH=/app/ssl/cert.pem
SSL_KEY_PATH=/app/ssl/key.pem
```

### 4. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

docker-compose up -d --build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose logs telegram-bot --tail=50
docker-compose logs redis-master --tail=30
docker-compose logs nginx --tail=30

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health checks
curl -k https://localhost:8443/health
curl http://localhost:8080/health
curl http://localhost:8001/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è Redis –∫–ª–∞—Å—Ç–µ—Ä–∞
docker-compose exec redis-master redis-cli -a $REDIS_PASSWORD cluster nodes
```

### 5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ Docker
docker-compose exec telegram-bot alembic upgrade head

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose exec telegram-bot alembic current

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
docker-compose exec telegram-bot python -c "from config.settings import settings; print('DB connected' if settings.database_url else 'DB not configured')"
```

### 6. –ó–∞–ø—É—Å–∫ –≤ development —Ä–µ–∂–∏–º–µ

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv venv
source venv/bin/activate  # –î–ª—è Windows: venv\Scripts\activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ Redis (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Docker)
redis-server redis/redis.conf

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
alembic upgrade head

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
python main.py

# –ó–∞–ø—É—Å–∫ —Å hot reload (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
python main.py --debug
```

### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ health checks
curl -k https://localhost:8443/health
curl http://localhost:8080/health
curl http://localhost:8001/health


# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps


# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker-compose logs telegram-bot --tail=20

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
docker-compose exec redis-master redis-cli -a $REDIS_PASSWORD ping

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
docker-compose exec telegram-bot python -c "from repositories.user_repository import UserRepository; import asyncio; print(asyncio.run(UserRepository().check_connection()))"
```

### 8. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
docker-compose logs -f telegram-bot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è Redis –∫–ª–∞—Å—Ç–µ—Ä–∞
docker-compose exec redis-master redis-cli -a $REDIS_PASSWORD info cluster

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```

telegram-bot/
‚îú‚îÄ‚îÄ alembic/                    # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ versions/              # –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ env.py                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
‚îÇ   ‚îî‚îÄ‚îÄ alembic.ini           # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Alembic
‚îú‚îÄ‚îÄ config/                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ **init**.py
‚îÇ   ‚îî‚îÄ‚îÄ settings.py           # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ core/                     # –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ **init**.py
‚îÇ   ‚îî‚îÄ‚îÄ interfaces.py         # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è SOLID
‚îú‚îÄ‚îÄ handlers/                 # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ **init**.py
‚îÇ   ‚îî‚îÄ‚îÄ message_handler.py    # Telegram –∫–æ–º–∞–Ω–¥—ã
‚îú‚îÄ‚îÄ repositories/             # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ **init**.py
‚îÇ   ‚îî‚îÄ‚îÄ user_repository.py    # –†–∞–±–æ—Ç–∞ —Å PostgreSQL
‚îú‚îÄ‚îÄ services/                 # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ **init**.py
‚îÇ   ‚îú‚îÄ‚îÄ payment_service.py    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Heleket
‚îÇ   ‚îú‚îÄ‚îÄ cache_service.py      # Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ user_cache.py         # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ session_cache.py      # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ payment_cache.py      # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ rate_limit_cache.py   # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ health_service.py     # Health check —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îú‚îÄ‚îÄ websocket_service.py  # WebSocket –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ circuit_breaker.py    # Circuit breaker pattern
‚îú‚îÄ‚îÄ utils/                    # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ **init**.py
‚îú‚îÄ‚îÄ nginx/                    # Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ nginx.conf           # –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ nginx.ssl.conf       # SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ conf.d/              # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏
‚îú‚îÄ‚îÄ redis/                    # Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ redis.conf           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis
‚îú‚îÄ‚îÄ ssl/                      # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ cert.pem
‚îÇ   ‚îú‚îÄ‚îÄ key.pem
‚îÇ   ‚îî‚îÄ‚îÄ generate-ssl.sh      # –°–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SSL
‚îú‚îÄ‚îÄ docker-compose.yml        # Docker —Å–µ—Ä–≤–∏—Å—ã
‚îú‚îÄ‚îÄ Dockerfile               # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ main.py                  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ requirements.txt         # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

```

## üîß –°–µ—Ä–≤–∏—Å—ã Docker Compose

| –°–µ—Ä–≤–∏—Å         | –ü–æ—Ä—Ç           | –û–ø–∏—Å–∞–Ω–∏–µ                          |
| -------------- | -------------- | --------------------------------- |
| telegram-bot   | 8001           | –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (webhook)     |
| telegram-bot   | 8081           | WebSocket –ø–æ—Ä—Ç                    |
| nginx          | 80, 443, 8080  | Reverse proxy —Å SSL               |
| redis-node-1   | 7379           | Redis master –Ω–æ–¥–∞                 |
| redis-node-2   | 7380           | Redis node 2                      |
| redis-node-3   | 7381           | Redis node 3                      |
| redis-replica-1| 7382           | Redis replica 1                   |
| redis-replica-2| 7383           | Redis replica 2                   |
| redis-replica-3| 7384           | Redis replica 3                   |
| PostgreSQL     | 5432           | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–≤–Ω–µ—à–Ω–∏–π Neon)        |

## üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Docker
docker-compose exec telegram-bot alembic revision --autogenerate -m "Add new table"

# –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic revision --autogenerate -m "Description"
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –ß–µ—Ä–µ–∑ Docker
docker-compose exec telegram-bot alembic upgrade head

# –õ–æ–∫–∞–ª—å–Ω–æ
alembic upgrade head

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–≤–∏–∑–∏–∏
alembic upgrade abc123
```

### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –û—Ç–∫–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏
docker-compose exec telegram-bot alembic downgrade -1

# –û—Ç–∫–∞—Ç –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–≤–∏–∑–∏–∏
docker-compose exec telegram-bot alembic downgrade abc123
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è handlers/message_handler.py

#### SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã –≤ –¥–µ–π—Å—Ç–≤–∏–∏

- **Single Responsibility** - –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- **Open/Closed** - —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–µ callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞
- **Liskov Substitution** - –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã
- **Interface Segregation** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π
- **Dependency Inversion** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π –≤–º–µ—Å—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π

#### –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

```python
class MessageHandler(EventHandlerInterface):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–µ—Å—Å–∏–π –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è"""
    
    async def handle_message(self, message: Message, bot: Bot) -> None:
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Å–µ—Å—Å–∏—è–º–∏"""
        # Rate limiting –ø—Ä–æ–≤–µ—Ä–∫–∞
        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
        
    async def handle_callback(self, callback: CallbackQuery, bot: Bot) -> None:
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ callback –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Å–µ—Å—Å–∏—è–º–∏"""
        # Rate limiting –ø—Ä–æ–≤–µ—Ä–∫–∞
        # –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è callback
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
```

### –°–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

#### –ù–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã

- **BalanceService** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **StarPurchaseService** - –ø–æ–∫—É–ø–∫–∞ –∑–≤–µ–∑–¥ —Å —Ä–∞–∑–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏
- **SessionCache** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Å–µ—Å—Å–∏—è–º–∏
- **RateLimitCache** - –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π
- **PaymentCache** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã

- **UserRepository** - –¥–æ–±–∞–≤–ª–µ–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **PaymentService** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å circuit breaker
- **UserCache** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

#### –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# –ò–µ—Ä–∞—Ä—Ö–∏—è –∫–µ—à–∞
1. User Cache - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (30 –º–∏–Ω)
2. Session Cache - —Å–µ—Å—Å–∏–∏ (30 –º–∏–Ω)
3. Payment Cache - –ø–ª–∞—Ç–µ–∂–∏ (15 –º–∏–Ω)
4. Rate Limit Cache - –ª–∏–º–∏—Ç—ã (1 –º–∏–Ω)
```

#### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

- **Cache-Aside** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º –∫ –ë–î
- **Write-Through** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–µ—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- **TTL** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **Cache Invalidation** - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—á–∏—â–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –ó–∞—â–∏—Ç–∞ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å

#### Circuit Breaker

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –ø—Ä–∏ —Å–±–æ—è—Ö
- Failure Threshold: 5 –æ—à–∏–±–æ–∫
- Recovery Timeout: 60 —Å–µ–∫—É–Ω–¥
- Half-Open Attempts: 3
- Expected Exceptions: –≤—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
```

#### Rate Limiting

```python
# –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞
- Messages: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
- Callbacks: 20 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
- API: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
- Payments: 2 –∑–∞–ø—Ä–æ—Å–∞ –≤ –º–∏–Ω—É—Ç—É
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- **Async/await** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **Connection Pooling** - –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å PostgreSQL
- **Redis Cluster** - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Batch Operations** - –≥—Ä—É–ø–ø–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î
- **Lazy Loading** - –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- **Health Checks** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **Metrics Collection** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **Logging** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **Error Tracking** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏ –∞–Ω–æ–º–∞–ª–∏–π

## üí≥ –ü–æ–∫—É–ø–∫–∞ –∑–≤–µ–∑–¥ —á–µ—Ä–µ–∑ Hele–∫–µ—Ç

### –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–∫—É–ø–∫–∏ —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –∑–∞—â–∏—Ç–∞–º–∏

```mermaid
sequenceDiagram
    participant User as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant Bot as Telegram Bot
    participant Cache as Redis Cache
    participant CB as Circuit Breaker
    participant Heleket as Heleket API
    participant DB as PostgreSQL
    participant RL as Rate Limiter

    User->>Bot: –ù–∞–∂–∏–º–∞–µ—Ç "–ü–æ–∫—É–ø–∫–∞ –ó–≤–µ–∑–¥"
    Bot->>RL: –ü—Ä–æ–≤–µ—Ä–∫–∞ rate limiting
    RL->>Bot: –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ/–ó–∞–ø—Ä–µ—Ç
    Bot->>Cache: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞ –ø–∞–∫–µ—Ç–æ–≤
    Cache-->>Bot: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã

    Bot->>User: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–∞–∫–µ—Ç—ã –∑–≤–µ–∑–¥
    User->>Bot: –í—ã–±–∏—Ä–∞–µ—Ç –ø–∞–∫–µ—Ç
    Bot->>CB: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è circuit breaker
    CB->>Bot: –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ/–ó–∞–ø—Ä–µ—Ç
    Bot->>Heleket: –°–æ–∑–¥–∞–µ—Ç —Å—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É
    Heleket->>Bot: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É

    Bot->>Cache: –ö–µ—à–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å—á–µ—Ç–∞
    Bot->>User: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É
    User->>Heleket: –û–ø–ª–∞—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç
    User->>Bot: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã

    Bot->>Cache: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞ —Å—Ç–∞—Ç—É—Å–∞
    Cache-->>Bot: –°—Ç–∞—Ç—É—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
    Bot->>CB: –ü—Ä–æ–≤–µ—Ä–∫–∞ circuit breaker
    CB->>Heleket: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å—á–µ—Ç–∞
    Heleket->>Bot: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—É

    Bot->>Cache: –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–µ—à —Å—Ç–∞—Ç—É—Å–∞
    Bot->>DB: –û–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    Bot->>User: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ–∫—É–ø–∫—É
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞–∫–µ—Ç—ã

#### üåü –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞–∫–µ—Ç—ã

- **100 –∑–≤–µ–∑–¥** - –±–∞–∑–æ–≤—ã–π –ø–∞–∫–µ—Ç (+10 –±–æ–Ω—É—Å–Ω—ã—Ö –∑–≤–µ–∑–¥, —ç–∫–æ–Ω–æ–º–∏—è 5%)
- **250 –∑–≤–µ–∑–¥** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞–∫–µ—Ç (+25 –±–æ–Ω—É—Å–Ω—ã—Ö –∑–≤–µ–∑–¥, —ç–∫–æ–Ω–æ–º–∏—è 10%)
- **500 –∑–≤–µ–∑–¥** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–∞–∫–µ—Ç (+50 –±–æ–Ω—É—Å–Ω—ã—Ö –∑–≤–µ–∑–¥, —ç–∫–æ–Ω–æ–º–∏—è 15%)
- **1000 –∑–≤–µ–∑–¥** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç (+100 –±–æ–Ω—É—Å–Ω—ã—Ö –∑–≤–µ–∑–¥, —ç–∫–æ–Ω–æ–º–∏—è 20%)

#### üíé –ü–æ–∫—É–ø–∫–∞ —Å –±–∞–ª–∞–Ω—Å–∞

- **100 –∑–≤–µ–∑–¥** - 100 TON —Å –±–∞–ª–∞–Ω—Å–∞
- **250 –∑–≤–µ–∑–¥** - 250 TON —Å –±–∞–ª–∞–Ω—Å–∞
- **500 –∑–≤–µ–∑–¥** - 500 TON —Å –±–∞–ª–∞–Ω—Å–∞
- **1000 –∑–≤–µ–∑–¥** - 1000 TON —Å –±–∞–ª–∞–Ω—Å–∞
- **–°–≤–æ—è —Å—É–º–º–∞** - –æ—Ç 1 –¥–æ 10000 –∑–≤–µ–∑–¥ —Å –±–∞–ª–∞–Ω—Å–∞

#### üéØ –ë—ã—Å—Ç—Ä–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ

- **10 TON** - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
- **50 TON** - –±—ã—Å—Ç—Ä–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
- **100 TON** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
- **500 TON** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
- **–°–≤–æ—è —Å—É–º–º–∞** - –æ—Ç 10 –¥–æ 10000 TON

## üé® –£–ª—É—á—à–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è v2.0

### –í–∏–∑—É–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–ë–æ—Ç –ø–æ–ª—É—á–∏–ª —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π:

- **–≠–º–æ–¥–∑–∏ –∏–∫–æ–Ω–∫–∏** - –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
- **HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º –∏ –∫—É—Ä—Å–∏–≤–æ–º
- **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ–Ω—é** - —á–µ—Ç–∫–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏
- **–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞** - —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

#### üåü –£–ª—É—á—à–µ–Ω–Ω–æ–µ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω —Å —ç–º–æ–¥–∑–∏
- –ß–µ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –∞–∫—Ü–µ–Ω—Ç–∞–º–∏
- –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

#### üí∞ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω –±–∞–ª–∞–Ω—Å–∞

- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–ª–∞–Ω—Å–µ
- –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

#### ‚≠ê –£–ª—É—á—à–µ–Ω–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω –∑–≤–µ–∑–¥

- –û–ø–∏—Å–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ —Å –±–æ–Ω—É—Å–∞–º–∏
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —ç–∫–æ–Ω–æ–º–∏–∏
- –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤
- –î–≤–∞ —Ä–µ–∂–∏–º–∞ –ø–æ–∫—É–ø–∫–∏: —Å –±–∞–ª–∞–Ω—Å–∞ –∏ —á–µ—Ä–µ–∑ –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É

#### üìä –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º –æ–ø–µ—Ä–∞—Ü–∏–π
- –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

#### üéØ –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

- –ü–æ–Ω—è—Ç–Ω—ã–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –í–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—à–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

#### üéâ –£–ª—É—á—à–µ–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

- –ü—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–ª–µ–¥—É—é—â–∏–º –¥–µ–π—Å—Ç–≤–∏—è–º

### –°–∏—Å—Ç–µ–º–∞ —Å–µ—Å—Å–∏–π

- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ Redis –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π –Ω–∞ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ —É–¥–æ–±—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

- **–ò–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã** - —É–¥–æ–±–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º
- **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–µ –º–µ–Ω—é** - –ª–æ–≥–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- **–í–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏** - —ç–º–æ–¥–∑–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–º–ø–æ–Ω–æ–≤–∫–∞** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- **–£–º–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –º–µ–Ω—é

### üéõÔ∏è –°–∏—Å—Ç–µ–º–∞ –∫–Ω–æ–ø–æ–∫ –∏ Callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ v2.0

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

–í—Å–µ callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `InlineKeyboardBuilder` –∏ —Å—Ç—Ä–æ–≥–æ–≥–æ —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è SOLID –ø—Ä–∏–Ω—Ü–∏–ø–∞–º:

```python
class CallbackHandler:
    """–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ callback –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–µ—Å—Å–∏–π"""
    
    async def handle_callback(self, callback: CallbackQuery, bot: Bot) -> None:
        """–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback —Å –ø–æ–ª–Ω—ã–º —Ü–∏–∫–ª–æ–º –∑–∞—â–∏—Ç—ã"""
        # 1. Rate limiting –ø—Ä–æ–≤–µ—Ä–∫–∞
        if not await self._check_rate_limit(callback.from_user.id):
            await callback.answer("‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.", show_alert=True)
            return
        
        # 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
        session = await self._restore_session(callback.from_user.id)
        
        # 3. –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è callback
        await self._route_callback(callback, bot, session)
    
    async def _check_rate_limit(self, user_id: int) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ rate limiting —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π"""
        return await self.rate_limit_cache.check_user_rate_limit(
            user_id, "callback", 20, 60
        )
```

#### –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

- **–ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** - –∫–∞–∂–¥—ã–π —Ç–∏–ø –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–µ—Ç–æ–¥–µ
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è** - –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö callback
- **–ó–∞—â–∏—Ç–∞ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö** - rate limiting, circuit breaker, –≤–∞–ª–∏–¥–∞—Ü–∏—è

#### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

##### üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

- `home` - –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `balance` - –ø—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- `buy_stars` - –ø–æ–∫—É–ø–∫–∞ –∑–≤–µ–∑–¥ (–º–∞–≥–∞–∑–∏–Ω)
- `help` - –ø–æ–º–æ—â—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- `settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è

##### üí∞ –ë–∞–ª–∞–Ω—Å –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

- `balance_main` - –æ—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω –±–∞–ª–∞–Ω—Å–∞
- `recharge` - –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
- `recharge_heleket` - –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Heleket
- `recharge_custom` - –±—ã—Å—Ç—Ä–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
- `balance_history` - –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- `transaction_{uuid}` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `back_to_balance` - –≤–æ–∑–≤—Ä–∞—Ç –∫ —ç–∫—Ä–∞–Ω—É –±–∞–ª–∞–Ω—Å–∞

##### ‚≠ê –ü–æ–∫—É–ø–∫–∞ –∑–≤–µ–∑–¥

- `buy_stars_main` - –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –º–∞–≥–∞–∑–∏–Ω–∞
- `buy_stars_with_balance` - –ø–æ–∫—É–ø–∫–∞ —Å –±–∞–ª–∞–Ω—Å–∞
- `buy_stars_with_payment` - –ø–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É
- `buy_100`, `buy_250`, `buy_500`, `buy_1000` - –≥–æ—Ç–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã
- `buy_100_balance`, `buy_250_balance`, `buy_500_balance`, `buy_1000_balance` - –ø–∞–∫–µ—Ç—ã —Å –±–∞–ª–∞–Ω—Å–∞
- `custom_amount` - –≤–≤–æ–¥ —Å–≤–æ–µ–π —Å—É–º–º—ã
- `custom_amount_balance` - –≤–≤–æ–¥ —Å–≤–æ–µ–π —Å—É–º–º—ã –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —Å –±–∞–ª–∞–Ω—Å–∞
- `back_to_buy_stars` - –≤–æ–∑–≤—Ä–∞—Ç –∫ –º–∞–≥–∞–∑–∏–Ω—É

##### üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

- `check_payment_{uuid}` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
- `check_recharge_{uuid}` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
- `refresh_status_{uuid}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

##### ‚ùì –ü–æ–º–æ—â—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- `help_main` - —ç–∫—Ä–∞–Ω –ø–æ–º–æ—â–∏
- `help_faq` - —á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- `create_ticket` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- `contact_admin` - –∫–æ–Ω—Ç–∞–∫—Ç —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
- `back_to_help` - –≤–æ–∑–≤—Ä–∞—Ç –∫ –ø–æ–º–æ—â–∏

#### –£–ª—É—á—à–µ–Ω–∏—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö v2.0

##### üõ°Ô∏è –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π Rate Limiting

- **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã** - —Å–æ–æ–±—â–µ–Ω–∏—è (10/–º–∏–Ω), callback (20/–º–∏–Ω), API (10/–º–∏–Ω), –ø–ª–∞—Ç–µ–∂–∏ (2/–º–∏–Ω)
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞** - –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º —Å—Ä–æ–∫–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö
- **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ª–∏–º–∏—Ç—ã** - –∑–∞—â–∏—Ç–∞ –æ—Ç –±–æ—Ç–æ–≤ –∏ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤** - –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

##### üîÑ –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∑–∞—â–∏—Ç—ã

- **Circuit Breaker** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –ø—Ä–∏ —Å–±–æ—è—Ö —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- **Retry with Exponential Backoff** - —É–º–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
- **Graceful Degradation** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **Circuit State Management** - –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞—â–∏—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

##### üéØ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –æ—à–∏–±–æ–∫** - —Å–µ—Ç–µ–≤—ã–µ, –ø–ª–∞—Ç–µ–∂–Ω—ã–µ, —Å–∏—Å—Ç–µ–º–Ω—ã–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è** - –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

##### üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - User Cache, Payment Cache, Session Cache, Rate Limit Cache
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç async/await –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–ü–∞–∫–µ—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –≥—Ä—É–ø–ø–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
- **–õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** - –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

##### üìä –£–ª—É—á—à–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫–∞–∂–¥—ã–π —à–∞–≥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å —Ç–∞–π–º–∏–Ω–≥–∞–º–∏
- **–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- **Health Checks** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–π –∏ –æ—à–∏–±–æ–∫

#### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

```python
# –ü—Ä–∏–º–µ—Ä callback –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∑–≤–µ–∑–¥
async def handle_buy_stars(self, callback: CallbackQuery, bot: Bot, session: UserSession) -> None:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∫—É–ø–∫–∏ –∑–≤–µ–∑–¥ —Å –ø–æ–ª–Ω—ã–º —Ü–∏–∫–ª–æ–º –∑–∞—â–∏—Ç—ã"""
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –∏–∑ –∫–µ—à–∞
    packages = await self.payment_cache.get_star_packages()
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –ø–∞–∫–µ—Ç–∞–º–∏
    keyboard = InlineKeyboardBuilder()
    for package in packages:
        keyboard.button(
            text=f"‚≠ê {package.stars} –∑–≤–µ–∑–¥ (+{package.bonus} –±–æ–Ω—É—Å–Ω—ã—Ö)",
            callback_data=f"buy_{package.id}"
        )
    
    # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–∞–∫–µ—Ç–∞–º–∏
    await callback.message.edit_text(
        "üåü –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–∫–µ—Ç –∑–≤–µ–∑–¥ –¥–ª—è –ø–æ–∫—É–ø–∫–∏:",
        reply_markup=keyboard.as_markup()
    )
    
    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
    session.current_state = "buying_stars"
    await self.session_cache.save_session(session)
```

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –±–æ—Ç–∞:

- –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö
- –£–ª—É—á—à–µ–Ω–æ –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ Health Checks

### Health Check Endpoints

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
curl -k https://localhost:8443/health
curl http://localhost:8080/health
curl http://localhost:8001/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
curl -k https://localhost:8443/health/db
curl http://localhost:8001/health/db

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è Redis
curl -k https://localhost:8443/health/redis
curl http://localhost:8001/health/redis

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
curl -k https://localhost:8443/health/payment
curl http://localhost:8001/health/payment
```

### Docker health checks

```bash

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps

# –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ health checks
docker inspect telegram-bot | jq '.[0].State.Health'

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ health checks
docker-compose logs telegram-bot | grep "health"
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ CLI

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f telegram-bot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è Redis –∫–ª–∞—Å—Ç–µ—Ä–∞

docker-compose exec redis-node-1 redis-cli -a $REDIS_PASSWORD info replication
docker-compose exec redis-node-1 redis-cli -a $REDIS_PASSWORD cluster nodes

# –ü—Ä–æ–≤–µ—Ä–∫–∞ PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
docker-compose exec telegram-bot python -c "from config.settings import settings; print('DB connected' if settings.database_url else 'DB not configured')"
```

## üõ†Ô∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```env
# Telegram Bot Configuration
TELEGRAM_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞ –æ—Ç @BotFather
WEBHOOK_HOST=your-domain.com

WEBHOOK_PORT=8001
WEBHOOK_PATH=/webhook

# Payment System - Heleket Configuration
MERCHANT_UUID=–≤–∞—à_merchant_uuid –æ—Ç Heleket
API_KEY=–≤–∞—à_api_key –æ—Ç Heleket
PAYMENT_TIMEOUT=300

# Database Configuration (Neon PostgreSQL)
DATABASE_URL=postgresql+asyncpg://username:password@host.neon.tech/database?ssl=require
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=30

# Redis Cluster Configuration






REDIS_MASTER_HOST=redis-node-1
REDIS_MASTER_PORT=7379
REDIS_SLAVE1_HOST=redis-node-2
REDIS_SLAVE1_PORT=7380
REDIS_SLAVE2_HOST=redis-node-3
REDIS_SLAVE2_PORT=7381
REDIS_PASSWORD=your_secure_redis_password
```

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```env
# Application Configuration
DEBUG=False
LOG_LEVEL=INFO
ENVIRONMENT=production
HEALTH_CHECK_INTERVAL=30

# Circuit Breaker Configuration
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_RECOVERY_TIMEOUT=60
CIRCUIT_BREAKER_EXPECTED_EXCEPTION=Exception

# Rate Limiting Configuration
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_BURST=10

# SSL Configuration
SSL_CERT_PATH=/app/ssl/cert.pem
SSL_KEY_PATH=/app/ssl/key.pem

# Redis Advanced Configuration
REDIS_MAX_CONNECTIONS=100
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5
REDIS_RETRY_ON_TIMEOUT=True
```

## üéØ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### Docker –∫–æ–º–∞–Ω–¥—ã

```bash

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ó–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π
docker-compose up -d --build


# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º —Ç–æ–º–æ–≤
docker-compose down -v

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose restart telegram-bot


# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose logs -f

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose logs telegram-bot --tail=100

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker-compose exec telegram-bot python main.py --check-connections
```

### Development –∫–æ–º–∞–Ω–¥—ã

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
alembic upgrade head

# –ó–∞–ø—É—Å–∫ —Å hot reload
python main.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
mypy .

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
black .
isort .

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è
flake8 .
```

### Redis –∫–æ–º–∞–Ω–¥—ã

```bash


# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis master (node-1)
docker-compose exec redis-node-1 redis-cli -a $REDIS_PASSWORD


# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
docker-compose exec redis-node-1 redis-cli -a $REDIS_PASSWORD info replication


# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–ª—é—á–µ–π
docker-compose exec redis-node-1 redis-cli -a $REDIS_PASSWORD keys "*"


# –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
docker-compose exec redis-node-1 redis-cli -a $REDIS_PASSWORD flushall

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞
docker-compose exec redis-node-1 redis-cli -a $REDIS_PASSWORD cluster nodes

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –∫–ª–∞—Å—Ç–µ—Ä–∞
docker-compose exec redis-node-1 redis-cli -a $REDIS_PASSWORD cluster info
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å v2.0

### üõ°Ô∏è –£–ª—É—á—à–µ–Ω–Ω—ã–µ –º–µ—Ä—ã –∑–∞—â–∏—Ç—ã

#### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

- **SSL/TLS** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —á–µ—Ä–µ–∑ Nginx —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π HTTP/2
- **PostgreSQL** - –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, SSL —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–æ–∫–æ–µ
- **Redis** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- **API –∫–ª—é—á–∏** - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ .env —Ñ–∞–π–ª–∞—Ö —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –∫–ª—é—á–µ–π

#### –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π

- **Rate limiting** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞ (Nginx + –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ + Redis)
- **Circuit breaker** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –æ—Ç–∫–∞–∑–æ–≤ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **Input validation** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **SQL Injection Protection** - –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ ORM
- **XSS Protection** - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è HTML –∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **CSRF Protection** - —Ç–æ–∫–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Ñ–æ—Ä–º –∏ callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

#### –ü–ª–∞—Ç–µ–∂–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **Heleket Integration** - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- **Payment Validation** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **Transaction Logging** - –ø–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **Fraud Detection** - –∞–ª–≥–æ—Ä–∏—Ç–º—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –º–æ—à–µ–Ω–Ω–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

#### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **Docker Security** - –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏, —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **Network Security** - –∏–∑–æ–ª—è—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤, —Ñ–∞–π—Ä–≤–æ–ª—ã, VPN –¥–ª—è –¥–æ—Å—Ç—É–ø–∞
- **Access Control** - RBAC (Role-Based Access Control) –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **Secret Management** - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –¥–æ—Å—Ç—É–ø –∫ —Å–µ–∫—Ä–µ—Ç–∞–º

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **Security Events Logging** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **Intrusion Detection** - –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
- **Anomaly Detection** - –∞–ª–≥–æ—Ä–∏—Ç–º—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∞–Ω–æ–º–∞–ª–∏–π –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Performance Monitoring** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### –ê—É–¥–∏—Ç –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å

- **Security Auditing** - —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π –∞—É–¥–∏—Ç —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **Compliance Monitoring** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **Incident Response** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **Backup and Recovery** - —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º

### üîê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### Environment variables

```env
# Security Configuration
SECURITY_ENABLED=True
ENCRYPTION_KEY_ROTATION_INTERVAL=86400  # 24 —á–∞—Å–∞
RATE_LIMIT_ENABLED=True
CIRCUIT_BREAKER_ENABLED=True
INPUT_VALIDATION_STRICT=True
PAYMENT_VALIDATION_ENABLED=True
AUDIT_LOGGING_ENABLED=True
```

#### Docker security settings

```yaml
# –ü—Ä–∏–º–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Docker
services:
  telegram-bot:
    security_opt:
      - no-new-privileges:true
      - apparmor:telegram-bot-profile
    read_only: true
    tmpfs:
      - /tmp
      - /var/tmp
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º—ã —Å Docker Compose

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker-compose config


# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose logs --tail=50

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±–µ–∑ –∫–µ—à–∞
docker-compose build --no-cache
docker-compose up -d

# –û—á–∏—Å—Ç–∫–∞ Docker —Å–∏—Å—Ç–µ–º—ã
docker system prune -f
docker volume prune -f
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å Redis –∫–ª–∞—Å—Ç–µ—Ä–æ–º

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è Redis master

docker-compose exec redis-node-1 redis-cli -a $REDIS_PASSWORD ping


# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
docker-compose exec redis-node-1 redis-cli -a $REDIS_PASSWORD info replication




# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è slave –Ω–æ–¥
docker-compose exec redis-replica-1 redis-cli -a $REDIS_PASSWORD info replication

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è Redis –∫–ª–∞—Å—Ç–µ—Ä–∞
docker-compose exec redis-node-1 redis-cli -a $REDIS_PASSWORD cluster nodes

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Redis —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose restart redis-node-1 redis-node-2 redis-node-3 redis-replica-1 redis-replica-2 redis-replica-3
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
docker-compose exec telegram-bot alembic current

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose exec telegram-bot alembic upgrade head

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker-compose exec telegram-bot env | grep DATABASE

# –°–±—Ä–æ—Å –±–∞–∑—ã (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
docker-compose exec telegram-bot alembic downgrade base
docker-compose exec telegram-bot alembic upgrade head
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
openssl x509 -in ssl/cert.pem -text -noout

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
openssl rsa -in ssl/key.pem -check

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
./ssl/generate-ssl.sh

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx
docker-compose restart nginx
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å circuit breaker

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è circuit breaker
docker-compose logs telegram-bot | grep "circuit_breaker"

# –°–±—Ä–æ—Å circuit breaker
docker-compose restart telegram-bot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –æ—à–∏–±–æ–∫
docker-compose logs telegram-bot | grep -i error
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å rate limiting

```bash

# –ü—Ä–æ–≤–µ—Ä–∫–∞ rate limit –ª–æ–≥–æ–≤
docker-compose logs telegram-bot | grep "rate_limit"

# –û—á–∏—Å—Ç–∫–∞ rate limit –∫–µ—à–∞
docker-compose exec redis-master redis-cli -a $REDIS_PASSWORD del rate_limit:*

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –ª–∏–º–∏—Ç–æ–≤
docker-compose exec telegram-bot python -c "from services.rate_limit_cache import RateLimitCache; import asyncio; print(asyncio.run(RateLimitCache().get_rate_limit_status('test_user')))"
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Ä—Ç–∞–º–∏

```bash

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω—è—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤
netstat -tulpn | grep -E '8080|8443|8081|8001|5432|7379|7380|7381|7382|7383|7384'

# –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ –≤ .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ docker-compose.yml –∏–ª–∏ .env —Ñ–∞–π–ª

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –Ω–æ–≤—ã–º–∏ –ø–æ—Ä—Ç–∞–º–∏
docker-compose down
docker-compose up -d
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Redis
docker-compose exec redis-master redis-cli -a $REDIS_PASSWORD info stats | grep keyspace

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π PostgreSQL
docker-compose exec telegram-bot python -c "from repositories.user_repository import UserRepository; import asyncio; print(asyncio.run(UserRepository().check_connection_pool()))"
```

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

```yaml
# –ü—Ä–∏–º–µ—Ä –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –≤ docker-compose.yml
services:
  telegram-bot:
    deploy:
      replicas: 3
    environment:
      - REDIS_MASTER_HOST=redis-cluster
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ production –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# Production –¥–µ–ø–ª–æ–π —Å SSL
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
docker-compose -f docker-compose.yml -f docker-compose.monitoring.yml up -d
```

## ü§ù Contributing

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É: `git checkout -b feature/AmazingFeature`
3. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
4. –°–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ö–µ–º—ã: `alembic revision --autogenerate -m "Add feature"`
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å Docker: `docker-compose up -d --build`
6. –°–¥–µ–ª–∞–π—Ç–µ –∫–æ–º–º–∏—Ç: `git commit -m 'Add some AmazingFeature'`
7. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è: `git push origin feature/AmazingFeature`
8. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ License

MIT License - —Å–º. —Ñ–∞–π–ª LICENSE –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs telegram-bot`

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health checks: `curl -k https://localhost:8443/health` –∏ `curl http://localhost:8001/health`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏: `docker-compose exec telegram-bot alembic current`

5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Neon PostgreSQL
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Redis –∫–ª–∞—Å—Ç–µ—Ä: `docker-compose exec redis-node-1 redis-cli -a $REDIS_PASSWORD ping`
7. –°–æ–∑–¥–∞–π—Ç–µ issue —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã, –ª–æ–≥–∞–º–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Aiogram Documentation](https://docs.aiogram.dev/)
- [Alembic Documentation](https://alembic.sqlalchemy.org/)
- [Heleket API Documentation](https://heleket.com/docs)
- [Neon PostgreSQL](https://neon.tech/docs)
- [Redis Cluster Documentation](https://redis.io/docs/manual/scaling/)
- [Docker Compose Documentation](https://docs.docker.com/compose/)

- [Nginx SSL Configuration](https://nginx.org/en/docs/http/configuring_https_servers.html)
